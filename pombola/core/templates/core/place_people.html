{% extends 'core/place_base.html' %}
{% load thumbnail %}
{% load humanize %}

{% block title %}{{ object.name }} People{% endblock %}

{% block subcontent %}

  <h2>Related People</h2>

  <div>

    <ul class="listing">
        {% for person_and_position in object.related_people %}
            {% with person=person_and_position.0 positions=person_and_position.1 %}
            <li>
                <a href="{{ person.get_absolute_url }}">
                    {% thumbnail person.primary_image "90x90" as im %}
                    <img src="{{ im.url }}" alt="{{ person.name }}" width="{{ im.width }}" height="{{ im.height }}" />
                    {% empty %}
                    <img src="{{STATIC_URL}}images/person-90x90.jpg" />
                    {% endthumbnail %}
                </a>

                <section>
                    <h4><a href="{{ person.get_absolute_url }}">{{ person.name }}</a></h4>
                      <ul>
                        {% for position in positions %}
                            {{ position.title }} of <a href="{{ position.place.get_absolute_url }}">{{ position.place.name }}
                        {% endfor %}
                      </ul>
                    <div class="read-more-wrap"><a href="{{ person.get_absolute_url }}" class="read-more">read more</a></div>
                </section>
            </li>
            {% endwith %}
        {% endfor %}
    </ul>

    <h3>People Related to Smaller Places in {{ object.name }}</h3>

    <ul class="listing">
        {% for child_place in object.child_places.all %}
            {% for person_and_position in child_place.related_people %}
              {% with person=person_and_position.0 positions=person_and_position.1 %}
                    {% if person %}
                        <li>
                            <a href="{{ person.get_absolute_url }}">
                                {% thumbnail person.primary_image "90x90" as im %}
                                    <img src="{{ im.url }}" alt="{{ person.name }}" width="{{ im.width }}" height="{{ im.height }}" />
                                {% empty %}
                                    <img src="{{STATIC_URL}}images/person-90x90.jpg" />
                                {% endthumbnail %}
                            </a>

                            <section>
                                <h4><a href="{{ person.get_absolute_url }}">{{ person.name }}</a></h4>
                                <ul>
                                  {% for position in positions %}
                                      {{ position.title }} of <a href="{{ position.place.get_absolute_url }}">{{ position.place.name }}
                                  {% endfor %}
                                </ul>
                                <div class="read-more-wrap"><a href="{{ person.get_absolute_url }}" class="read-more">read more</a></div>
                            </section>
                        </li>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        {% endfor %}
    </ul>
  </div>

{% endblock %}
